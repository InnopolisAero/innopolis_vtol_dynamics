<launch>
    <!--
        Prerequirements:
        DONT_RUN=1 make px4_sitl_default gazebo
        or
        DONT_RUN=1 make px4_sitl gazebo_standard_vtol
     -->
    <arg name="vehicle"             default="standard_vtol" doc="[standard_vtol, iris]"/>
    <arg name="fcu_url"             default="udp://:14540@127.0.0.1:14557" doc="[udp://:14560@127.0.0.1:14558]"/>

    <!-- 1. Launch the simulation and connect ROS to it via MAVROS -->
    <include file="$(find mavros)/launch/px4.launch">
        <arg name="fcu_url" value="$(arg fcu_url)"/>
    </include>

    <!-- 2. Launch px4 sitl -->
    <include file="$(find timed_roslaunch)/launch/timed_roslaunch.launch">
        <arg name="time" value="3" />
        <arg name="pkg" value="px4" />
        <arg name="node_name" value="px4" />

        <arg name="file" value="px4.launch" />
        <arg name="value" value="vehicle:=$(arg vehicle)" />
    </include>

    <!-- 3. Run dynamic simulation -->
    <rosparam file="$(find innopolis_vtol_dynamics)/config/multicopter_params.yaml" command="load" ns="uav/multicopter_params" />
    <rosparam file="$(find innopolis_vtol_dynamics)/config/sim_params.yaml" command="load" ns="uav/sim_params" />
    <node pkg="innopolis_vtol_dynamics" type="node" name="node" output="screen">
        <param name="vehicle" value="$(arg vehicle)" />/>
    </node>
</launch>
